<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adrian Kommunikator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="rotate-hint">
        <div class="icon">ğŸ“±</div>
        <h2>Bitte Handy drehen</h2>
        <p>Die App funktioniert am besten im Querformat.</p>
    </div>

    <div class="app">
        <header>
            <h1>ğŸ§¸ Adrian sagt</h1>
            <button onclick="einstellungen()">âš™ï¸</button>
        </header>

        <div class="anzeige">
            <span id="text">Tippe auf ein Bild...</span>
            <button onclick="vorlesen()">ğŸ”Š</button>
            <button onclick="loeschen()">ğŸ—‘ï¸</button>
        </div>

        <div class="pfad" id="pfad">HauptmenÃ¼</div>

        <div class="grid" id="grid"></div>
    </div>

    <!-- Einstellungen -->
    <div class="modal" id="modal">
        <div class="modal-box">
            <h2>âš™ï¸ Einstellungen</h2>
            
            <h3>ğŸ–¼ï¸ Eigene Bilder</h3>
            <div class="uploads">
                <div>
                    <label>ğŸ Essen</label>
                    <input type="file" accept="image/*" onchange="bild('essen', this)">
                    <img id="img-essen">
                </div>
                <div>
                    <label>ğŸ¥› Trinken</label>
                    <input type="file" accept="image/*" onchange="bild('trinken', this)">
                    <img id="img-trinken">
                </div>
                <div>
                    <label>ğŸš½ WC</label>
                    <input type="file" accept="image/*" onchange="bild('wc', this)">
                    <img id="img-wc">
                </div>
                <div>
                    <label>ğŸ› Baden</label>
                    <input type="file" accept="image/*" onchange="bild('baden', this)">
                    <img id="img-baden">
                </div>
                <div>
                    <label>ğŸ§¸ Spielen</label>
                    <input type="file" accept="image/*" onchange="bild('spielen', this)">
                    <img id="img-spielen">
                </div>
                <div>
                    <label>ğŸ‘© Mama</label>
                    <input type="file" accept="image/*" onchange="bild('mama', this)">
                    <img id="img-mama">
                </div>
            </div>

            <h3>ğŸ”Š Sprache</h3>
            <label>Geschwindigkeit:</label>
            <input type="range" id="speed" min="0.3" max="1.5" step="0.1" value="0.8">

            <br><br>
            <button onclick="schliessen()" class="save">ğŸ’¾ Speichern</button>
        </div>
    </div>

    <script>
        // Daten
        const daten = {
            haupt: [
                {id: 'essen', text: 'Essen', icon: 'ğŸ', farbe: '#FF9800', 
                 subs: ['Apfel', 'Banane', 'Brot', 'Milch']},
                {id: 'trinken', text: 'Trinken', icon: 'ğŸ¥›', farbe: '#2196F3',
                 subs: ['Wasser', 'Saft', 'Tee']},
                {id: 'wc', text: 'WC', icon: 'ğŸš½', farbe: '#FFEB3B',
                 subs: ['Pipi', 'Pupu', 'HÃ¤nde waschen']},
                {id: 'baden', text: 'Baden', icon: 'ğŸ›', farbe: '#03A9F4',
                 subs: ['Badewanne', 'Duschen', 'ZÃ¤hne']},
                {id: 'spielen', text: 'Spielen', icon: 'ğŸ§¸', farbe: '#4CAF50',
                 subs: ['Ball', 'Auto', 'Malen']},
                {id: 'mama', text: 'Mama', icon: 'ğŸ‘©', farbe: '#E91E63',
                 subs: ['Umarmung', 'Hilfe', 'Schlafen']}
            ]
        };

        let pfad = ['haupt'];
        let satz = '';
        let bilder = JSON.parse(localStorage.getItem('bilder') || '{}');
        let aktuell = null;

        // Start
        function zeigen() {
            const grid = document.getElementById('grid');
            const pfadText = document.getElementById('pfad');
            grid.innerHTML = '';

            // Pfad anzeigen
            const wo = pfad.map(p => p === 'haupt' ? 'HauptmenÃ¼' : 
                daten.haupt.find(x => x.id === p)?.text || p).join(' â†’ ');
            pfadText.textContent = wo;

            // ZurÃ¼ck-Button
            if (pfad.length > 1) {
                const zurueck = document.createElement('button');
                zurueck.className = 'zurueck';
                zurueck.textContent = 'â† ZurÃ¼ck';
                zurueck.onclick = () => { pfad.pop(); zeigen(); };
                grid.appendChild(zurueck);
            }

            // Inhalt
            const ort = pfad[pfad.length - 1];
            if (ort === 'haupt') {
                daten.haupt.forEach(item => {
                    const div = makeKachel(item);
                    div.onclick = () => {
                        if (item.subs) {
                            pfad.push(item.id);
                            zeigen();
                        } else {
                            waehlen(`Ich will ${item.text}`, div);
                        }
                    };
                    grid.appendChild(div);
                });
            } else {
                const parent = daten.haupt.find(x => x.id === ort);
                parent.subs.forEach(sub => {
                    const div = document.createElement('div');
                    div.className = 'kachel';
                    div.style.background = parent.farbe;
                    div.innerHTML = `<div class="inhalt">${sub}</div>`;
                    div.onclick = () => waehlen(`Ich will ${sub} ${parent.text}`, div);
                    grid.appendChild(div);
                });
            }
        }

        function makeKachel(item) {
            const div = document.createElement('div');
            div.className = 'kachel';
            div.style.background = item.farbe;
            
            const hatBild = bilder[item.id];
            if (hatBild) {
                div.style.backgroundImage = `url(${hatBild})`;
                div.style.backgroundSize = 'cover';
                div.innerHTML = `<div class="inhalt bild-text">${item.text}</div>`;
            } else {
                div.innerHTML = `<div class="inhalt"><div class="big">${item.icon}</div>${item.text}</div>`;
            }
            
            if (item.subs) div.classList.add('ordner');
            return div;
        }

        function waehlen(text, el) {
            satz = text;
            document.getElementById('text').textContent = text;
            if (aktuell) aktuell.classList.remove('aktiv');
            el.classList.add('aktiv');
            aktuell = el;
            if (navigator.vibrate) navigator.vibrate(50);
            setTimeout(vorlesen, 200);
        }

        function vorlesen() {
            if (!satz) return;
            const s = new SpeechSynthesisUtterance(satz);
            s.lang = 'de-DE';
            s.rate = document.getElementById('speed').value;
            speechSynthesis.cancel();
            speechSynthesis.speak(s);
        }

        function loeschen() {
            satz = '';
            document.getElementById('text').textContent = 'Tippe auf ein Bild...';
            if (aktuell) aktuell.classList.remove('aktiv');
            aktuell = null;
        }

        // Einstellungen
        function einstellungen() {
            document.getElementById('modal').style.display = 'flex';
            // Bilder laden
            for (let key in bilder) {
                const img = document.getElementById('img-' + key);
                if (img) {
                    img.src = bilder[key];
                    img.style.display = 'block';
                }
            }
        }

        function schliessen() {
            document.getElementById('modal').style.display = 'none';
        }

        function bild(kat, input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = e => {
                bilder[kat] = e.target.result;
                localStorage.setItem('bilder', JSON.stringify(bilder));
                document.getElementById('img-' + kat).src = e.target.result;
                document.getElementById('img-' + kat).style.display = 'block';
                zeigen(); // Neu laden
            };
            reader.readAsDataURL(file);
        }

        // Start
        zeigen();
    </script>
</body>
</html>
